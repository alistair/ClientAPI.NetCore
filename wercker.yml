box: ubuntu
build:
  steps:
    - script:
        name: install dotnet core
        code: |
          apt-get update
          apt-get install apt-transport-https -y
          sh -c 'echo "deb [arch=amd64] https://apt-mo.trafficmanager.net/repos/dotnet-release/ xenial main" > /etc/apt/sources.list.d/dotnetdev.list'
          apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 417A0893
          apt-get update
          apt-get install dotnet-dev-1.0.0-preview2-003156 -y

    - script:
        name: install and run eventstore
        code: |
          apt-get install wget
          wget http://download.geteventstore.com/binaries/EventStore-OSS-Ubuntu-14.04-v3.9.3.tar.gz
          tar xfv EventStore-OSS-Ubuntu-14.04-v3.9.3.tar.gz
          nohup ./EventStore-OSS-Ubuntu-14.04-v3.9.3/eventstored --enable-trusted-auth --run-projections All --mem-db --log $WERCKER_REPORT_ARTIFACTS_DIR &
          
    # Build
    - script:
        name: Build project
        code: |
          ./build.sh
    - script:
      name: copy file
      code : |
        sh -c 'echo "I am output, look at me" > test.txt'
        cp test.txt $WERCKER_REPORT_ARTIFACTS_DIR
    # Run tests
    - script:
        name: Run tests
        code: |
          dotnet restore
          ./run_surpressed_tests.sh
